---
title: "Generating a package"
subtitle: "Minimum example"
output: 
  html_document:
    highlight: haddock
    theme: united
    toc: no
    toc_float: no
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE, message = FALSE, warning = FALSE)
```

Your best source when it comes to learning the ins and outs of package generation is the book [R packages](https://github.com/fishvice/tcrenv2016.git).

Basically within R-studio the minimum needed is the following:

1. Install the package `roxygen2` if you have not already done so.
2. File > New Project > New Directory > R Package > type in package name.
    - Suggest you use the name "tcrtools".
3. Suggest you then do: Tools > Project Options > Build tools > Configure and make sure that the following "tick-boxes" are "ticked" - see figure below:

<div style="width:300px; height=300px">
![](http://r-pkgs.had.co.nz/screenshots/build-reload-opts-2.png)
</div>

4. Put some functions (R scripts) you have created into the R-directory
    - Here I suggest, just to put something in, to open a blank R-script (File > New File > R Script).
    - Copy the **whole** code-chunk (including comments at the top) for the `encode_zchords`-function that is located in the [High resolution gridding](b_highresolutiongridding.html)-document (see header: "Create a gridding functions") on the course home page into the blank R-script file.
    - Save the R-script with the file name "encode_zchords.R" in the R-directory that already resides within the current project.
6. Do: Build > Build and Reload
7. If the steps above go smoothly you should by the end of last command see that your library (tcrtools) has been loaded into your current session.
8. Then start a new project and do:
```{r}
library(tidyverse)
library(lubridate)
# if you have not build the tcrtools-package on your computer you can do:
# devtools::install_github("fishvice/tcrenv2017/tcrtools")
library(tcrtools)

# Read the helpfile for our function:
?encode_zchords

# Do some plot
read_csv("data/logbook_station.csv") %>% 
  # get the year from the date variable
  mutate(year = year(date),
         # create the sq-code using the function in the tcrtools package
         sq = encode_zchords(lon, lat, dx = 0.25)) %>% 
  # prepare summarizing by year and square
  group_by(year, sq) %>% 
  # sum the stuff
  summarize(effort = sum(towtime / 60, na.rm = TRUE)) %>% 
  # get the central coordinate position from the varible sq, make it numerical
  separate(sq, c("lon", "lat"), sep = ":", convert = TRUE) %>% 
  # plot the stuff as raster
  ggplot() +
  theme_bw() +
  geom_raster(aes(lon, lat, fill = effort)) +
  geom_polygon(data = map_data("world", region = "Iceland"),
               aes(long, lat, group = group)) +
  # use a viridis colour scheme instead of the ggplot2 default "blues"
  scale_fill_continuous(type = "viridis", option = "B", direction = -1) +
  # create an approximate aspect ration
  coord_quickmap() +
  labs(x = NULL, y = NULL)
```

